# kakaoDistribute
카카오 뿌리기

[상세 개발 정보]
1. 개발 언어 : JAVA (1.8)
2. 사용 프레임 워크 : Spring (Maven, Mybatis)
3. 사용 DB : Postgresql (오라클이 메인이지만 라이센스 문제로 대체 사용하였습니다.)
4. DB서버 : Amazon RDS
5. 서버 : TOMCAT 7.0 ( 버전 무관 ), [메이븐 프로젝트로 임포트, 메이븐 업데이트 후 바로 톰캣으로 실행 가능]
6. 테스트방법 : POSTMAN Request
* 임의로 톰캣, 메이븐 등 프로젝트 구성을 설정하여도 되는지 문의 드리고 싶었으나, 연휴기간과 겹쳐 일단 구현하였습니다. 
혹시 제약조건이 있을시 회신주시면 일정내에 다른방식으로 구현 후 제출하도록하겠습니다.
* UNIT테스트를 진행하며 예상되는 테스트결과값을 트레이싱하며 개발진행하였지만, 상세 UNIT테스트 내역을 별도 저장하지 못하여 최종 테스트시나리오
 결과 별첨드리겠습니다.
 - kakaoDistribute/KAKAO/카카오뿌리기테스트시나리오.xlsx 참조
API 스펙 (응답코드, 응답메세지 등...)
- kakaoDistribute/KAKAO/카카오뿌리기API정의서_v1.00.xlsx 참조
DB 명세서 
- kakaoDistribute/KAKAO/카카오뿌리기DB명세서_v1.00.xlsx 참조

[DB 설계 정보]
1. 뿌리기 원거래 정보 테이블 / 뿌리기 상세 거래 정보 테이블 생성
2. kao_dist_id(PK),kao_dist_detail_id(PK)
3. 분포도가 높고 키로 조회되는 token 컬럼 index
4. 날짜 기준 파티셔닝

[핵심 문제해결 전략]
1. 뿌리기 API 
  뿌리기 요청이 들어올 경우 랜덤 토큰 생성 후, 중복방지 로직처리 후
  원거래 정보를 뿌리기 원거래정보 테이블에 (1회), 
  요청 인원으로 금액을 분배하여 상세테이블에 각각(N회) 저장 (받는 사람을 null 로 저장) [금액 분배는 1/N, 잔액은 랜덤 1인에게 추가]
2. 받기 API
  받기 요청이 올경우 토큰/방 정보로 원거래 건 조회,
  자신의 거래건인지, 뿌리기 완료된건인지 확인
  유효한 거래일 경우 상세 정보 중 받는 사람이 null 인 거래건 조회
  null을 해당 요청자 로 업데이트 [조건에 요청자 = null 을 추가함으로써 동시성 처리 방지, 업데이트 횟수가 0개일 경우 중복처리이기떄문에 Exception(트랜잭션 처리로 롤백)]
  업데이트 해당 사용자로 해당 뿌리기에 금액을 조회 [결과값이 2개일 경우 중복처리이기 떄문에 Exception(트랜잭션 처리로 롤백)]
3. 조회 API
  원거래 테이블 / 상세조회 테이블을 조인하여 결과값 가져오기
  자신의 뿌리기 건, 7일 이내 건만 조회
  상세 거래정보는 List로 내려줌
  
  * 그외 상세 API 스펙은 API 정의서 문서에 첨부하였습니다.
  
  
